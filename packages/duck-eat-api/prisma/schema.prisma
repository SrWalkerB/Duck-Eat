// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum ROLES {
  ADMIN
  CLIENT
  RESTAURANT_ADMIN
}

model Organization {
  id                  String                @id @default(uuid())
  name                String
  ownerId             String                @map("owner_id")
  owner               User                  @relation(fields: [ownerId], references: [id])
  slug                String                @unique
  createdAt           DateTime              @default(now()) @map("created_at")
  updatedAt           DateTime              @updatedAt @map("updated_at")
  deletedAt           DateTime?             @map("deleted_at")
  companies           Company[]
  organizationMembers OrganizationMembers[]
  products            Product[]

  @@map("organizations")
}

model OrganizationMembers {
  id             String       @id @default(uuid())
  organizationId String       @map("organization_id")
  organization   Organization @relation(fields: [organizationId], references: [id])
  userId         String       @map("user_id")
  user           User         @relation(fields: [userId], references: [id])
  createdAt      DateTime     @default(now()) @map("created_at")
  updatedAt      DateTime     @updatedAt @map("updated_at")
  deletedAt      DateTime?    @map("deleted_at")

  @@unique([organizationId, userId])
  @@map("organization_members")
}

model Account {
  id        String    @id @default(uuid())
  email     String    @unique
  password  String
  role      ROLES
  provider  String
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at")
  users     User[]

  @@map("account")
}

model User {
  id                  String                @id @default(uuid())
  name                String
  account             Account               @relation(fields: [accountId], references: [id])
  accountId           String                @unique @map("account_id")
  createdAt           DateTime              @default(now()) @map("created_at")
  updatedAt           DateTime              @updatedAt @map("updated_at")
  deletedAt           DateTime?             @map("deleted_at")
  organizations       Organization[]
  organizationMembers OrganizationMembers[]

  @@map("user")
}

model Company {
  id                    String                 @id @default(uuid())
  tradeName             String                 @map("trade_name")
  cnpj                  String
  organizationId        String                 @map("organizationId")
  organization          Organization           @relation(fields: [organizationId], references: [id])
  createdAt             DateTime               @default(now()) @map("created_at")
  updatedAt             DateTime               @updatedAt @map("updated_at")
  deletedAt             DateTime?              @map("deleted_at")
  companyTagId          String                 @map("company_tag_id")
  companyTag            CompanyTag             @relation(fields: [companyTagId], references: [id])
  companyPaymentMethods CompanyPaymentMethod[]
  companyLogos          CompanyLogo[]
  companySessions       CompanySession[]
  companyAbout          CompanyAbout?          @relation(fields: [companyAboutId], references: [id])
  companyAboutId        String?                @map("company_about_id")

  @@map("company")
}

model CompanyAbout {
  id          String    @id @default(uuid())
  description String?
  address     String?
  companyId   String    @map("company_id")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  deleteAt    DateTime?
  companies   Company[]

  @@map("company_about")
}

enum CompanyLogoContext {
  PROFILE
  COVER
}

model CompanyLogo {
  id        String             @id @default(uuid())
  logo      String
  context   CompanyLogoContext
  company   Company            @relation(fields: [companyId], references: [id])
  createdAt DateTime           @default(now()) @map("created_at")
  updatedAt DateTime           @updatedAt @map("updated_at")
  deletedAt DateTime?          @map("deleted_at")
  companyId String             @map("company_id")

  @@map("company_logo")
}

model CompanyTag {
  id        String    @id @default(uuid())
  name      String
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at")
  companies Company[]

  @@map("company_tag")
}

model OpeningWeekDay {
  id                  String                @id @default(uuid())
  day                 String
  tag                 String
  createdAt           DateTime              @default(now()) @map("created_at")
  updatedAt           DateTime              @updatedAt @map("updated_at")
  deletedAt           DateTime?             @map("deleted_at")
  companyOpeningHours CompanyOpeningHours[]

  @@unique([tag])
  @@map("opening_week_day")
}

model CompanyOpeningHours {
  id               String         @id @default(uuid())
  startTime        DateTime
  endTime          DateTime
  openingWeekDay   OpeningWeekDay @relation(fields: [openingWeekDayId], references: [id])
  createdAt        DateTime       @default(now()) @map("created_at")
  updatedAt        DateTime       @updatedAt @map("updated_at")
  deletedAt        DateTime?      @map("deleted_at")
  openingWeekDayId String         @map("opening_week_day_id")

  @@map("company_opening_hours")
}

enum PaymentContext {
  ON_DELIVERY
  IN_PERSON
}

model CompanyPaymentMethod {
  id              String         @id @default(uuid())
  companyId       String         @map("company_id")
  company         Company        @relation(fields: [companyId], references: [id])
  paymentMethodId String         @map("payment_method_id")
  paymentMethod   PaymentMethod  @relation(fields: [paymentMethodId], references: [id])
  paymentContext  PaymentContext @map("payment_context")
  createdAt       DateTime       @default(now()) @map("created_at")
  updatedAt       DateTime       @updatedAt @map("updated_at")

  @@unique([companyId, paymentMethodId])
  @@map("company_payment_method")
}

model PaymentMethod {
  id                    String                 @id @default(uuid())
  name                  String
  tag                   String                 @unique
  createdAt             DateTime               @default(now()) @map("created_at")
  updatedAt             DateTime               @updatedAt @map("updated_at")
  deletedAt             DateTime?              @map("deleted_at")
  companyPaymentMethods CompanyPaymentMethod[]

  @@map("payment_method")
}

model CompanySession {
  id                     String                  @id @default(uuid())
  name                   String
  company                Company                 @relation(fields: [companyId], references: [id])
  createdAt              DateTime                @default(now()) @map("created_at")
  updatedAt              DateTime                @updatedAt @map("updated_at")
  deletedAt              DateTime?               @map("deleted_at")
  companyId              String                  @map("company_id")
  companySessionProducts CompanySessionProduct[]

  @@map("company_session")
}

model Product {
  id                     String                  @id @default(uuid())
  organizationId         String                  @map("organization_id")
  organization           Organization            @relation(fields: [organizationId], references: [id])
  name                   String
  description            String?
  price                  Float
  createdAt              DateTime                @default(now()) @map("created_at")
  updatedAt              DateTime                @updatedAt @map("updated_at")
  deletedAt              DateTime?               @map("deleted_at")
  companySessionProducts CompanySessionProduct[]
  productPhotos          ProductPhotos[]

  @@map("products")
}

model ProductPhotos {
  id          String    @id @default(uuid())
  photoUrlKey String    @map("photo_url_key")
  productId   String    @map("product_id")
  product     Product   @relation(fields: [productId], references: [id])
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  deletedAt   DateTime? @map("deleted_at")

  @@map("product_photos")
}

model CompanySessionProduct {
  id               String         @id @default(uuid())
  product          Product        @relation(fields: [productId], references: [id])
  companySession   CompanySession @relation(fields: [companySessionId], references: [id])
  productId        String         @map("product_id")
  companySessionId String         @map("company_session_id")
  createdAt        DateTime       @default(now()) @map("created_at")
  updatedAt        DateTime       @updatedAt @map("updated_at")
  deletedAt        DateTime?      @map("deleted_at")

  @@unique([productId, companySessionId])
  @@map("company_session_product")
}
