// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  MASTER_ADMIN
  CLIENT
  ADMIN
}

model Account {
  id        String    @id @default(uuid())
  email     String    @unique
  password  String
  role      Role
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at")
  users     User[]

  @@map("account")
}

model User {
  id        String    @id @default(uuid())
  name      String
  account   Account   @relation(fields: [accountId], references: [id])
  accountId String    @unique @map("account_id")
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at")
  companies Company[]

  @@map("user")
}

model Company {
  id                    String                 @id @default(uuid())
  tradeName             String                 @map("trade_name")
  cnpj                  String
  ownerId               String                 @map("owner_id")
  owner                 User                   @relation(fields: [ownerId], references: [id])
  createdAt             DateTime               @default(now()) @map("created_at")
  updatedAt             DateTime               @updatedAt @map("updated_at")
  deletedAt             DateTime?              @map("deleted_at")
  companyPaymentMethods CompanyPaymentMethod[]
  companyLogos          CompanyLogo[]
  companySessions       CompanySession[]

  @@map("company")
}

model CompanyAbout {
  id           String   @id @default(uuid())
  description  String?
  address      String?
  companyTagId String?  @map("company_tag_id")
  companyId    String   @map("company_id")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  @@map("company_about")
}

enum CompanyLogoContext {
  PROFILE
  COVER
}

model CompanyLogo {
  id        String             @id @default(uuid())
  logo      String
  context   CompanyLogoContext
  company   Company            @relation(fields: [companyId], references: [id])
  createdAt DateTime           @default(now()) @map("created_at")
  updatedAt DateTime           @updatedAt @map("updated_at")
  deletedAt DateTime?          @map("deleted_at")
  companyId String             @map("company_id")

  @@map("company_logo")
}

model CompanyTag {
  id        String   @id @default(uuid())
  name      String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("company_tag")
}

model OpeningWeekDay {
  id                  String                @id @default(uuid())
  day                 String
  tag                 String
  createdAt           DateTime              @default(now()) @map("created_at")
  updatedAt           DateTime              @updatedAt @map("updated_at")
  companyOpeningHours CompanyOpeningHours[]

  @@unique([tag])
  @@map("opening_week_day")
}

model CompanyOpeningHours {
  id               String         @id @default(uuid())
  startTime        DateTime
  endTime          DateTime
  openingWeekDay   OpeningWeekDay @relation(fields: [openingWeekDayId], references: [id])
  createdAt        DateTime       @default(now()) @map("created_at")
  updatedAt        DateTime       @updatedAt @map("updated_at")
  openingWeekDayId String         @map("opening_week_day_id")

  @@map("company_opening_hours")
}

enum PaymentContext {
  ON_DELIVERY
  IN_PERSON
}

model CompanyPaymentMethod {
  id              String         @id @default(uuid())
  companyId       String         @map("company_id")
  company         Company        @relation(fields: [companyId], references: [id])
  paymentMethodId String         @map("payment_method_id")
  paymentMethod   PaymentMethod  @relation(fields: [paymentMethodId], references: [id])
  paymentContext  PaymentContext @map("payment_context")
  createdAt       DateTime       @default(now()) @map("created_at")
  updatedAt       DateTime       @updatedAt @map("updated_at")

  @@unique([companyId, paymentMethodId])
  @@map("company_payment_method")
}

model PaymentMethod {
  id                    String                 @id @default(uuid())
  name                  String
  tag                   String
  createdAt             DateTime               @default(now()) @map("created_at")
  updatedAt             DateTime               @updatedAt @map("updated_at")
  deletedAt             DateTime?              @map("deleted_at")
  companyPaymentMethods CompanyPaymentMethod[]

  @@index([tag])
  @@map("payment_method")
}

model CompanySession {
  id                     String                  @id @default(uuid())
  name                   String
  company                Company                 @relation(fields: [companyId], references: [id])
  createdAt              DateTime                @default(now()) @map("created_at")
  updatedAt              DateTime                @updatedAt @map("updated_at")
  deletedAt              DateTime?               @map("deleted_at")
  companyId              String                  @map("company_id")
  companySessionProducts CompanySessionProduct[]

  @@map("company_session")
}

model CompanyProduct {
  id                     String                  @id @default(uuid())
  companyId              String                  @map("company_id")
  name                   String
  description            String?
  price                  Float
  createdAt              DateTime                @default(now()) @map("created_at")
  updatedAt              DateTime                @updatedAt @map("updated_at")
  deletedAt              DateTime?               @map("deleted_at")
  companySessionProducts CompanySessionProduct[]
  companyProductPhotos   CompanyProductPhotos[]

  @@map("company_product")
}

model CompanyProductPhotos {
  id               String         @id @default(uuid())
  photoUrl         String         @map("photo_url")
  companyProduct   CompanyProduct @relation(fields: [companyProductId], references: [id])
  createdAt        DateTime       @default(now()) @map("created_at")
  updatedAt        DateTime       @updatedAt @map("updated_at")
  deletedAt        DateTime?      @map("deleted_at")
  companyProductId String         @map("company_product_id")

  @@map("company_product_photos")
}

model CompanySessionProduct {
  id               String         @id @default(uuid())
  companyProduct   CompanyProduct @relation(fields: [companyProductId], references: [id])
  companySession   CompanySession @relation(fields: [companySessionId], references: [id])
  companyProductId String         @map("company_product_id")
  companySessionId String         @map("company_session_id")
  createdAt        DateTime       @default(now()) @map("created_at")
  updatedAt        DateTime       @updatedAt @map("updated_at")
  deletedAt        DateTime?      @map("deleted_at")

  @@unique([companyProductId, companySessionId])
  @@map("company_session_product")
}
